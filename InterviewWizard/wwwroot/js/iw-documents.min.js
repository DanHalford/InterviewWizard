/*! asp.net 2025-01-30 */
let dropZones=new Map;var dragCounter=0;function DropZoneDragEnter(e,t){dragCounter++,e.classList.add("drop-zone-drag-over")}function DropZoneDragOver(e,t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy",e.classList.add("drop-zone-drag-over"),e.querySelector(".status-icon").querySelector("i").classList.remove("bi-download"),e.querySelector(".status-icon").querySelector("i").classList.add("bi-cloud-plus-fill"),e.querySelector(".status-label").classList.add("visually-hidden")}function DropZoneDrop(e,t){t.stopPropagation(),t.preventDefault(),e.classList.remove("drop-zone-drag-over"),e.classList.add("drop-zone-processing"),e.querySelector(".status-icon").querySelector("i").classList.remove("bi-cloud-plus-fill"),e.querySelector(".status-icon").querySelector("i").classList.add("bi-cloud-arrow-up-fill","drop-zone-animation"),uploadFile(e,t.dataTransfer.files)}function DropZoneDragLeave(e,t){t.stopPropagation(),t.preventDefault(),0===--dragCounter&&(e.classList.remove("drop-zone-drag-over"),e.querySelector(".status-icon").querySelector("i").classList.remove("bi-cloud-plus-fill"),e.querySelector(".status-icon").querySelector("i").classList.add("bi-download"),e.querySelector(".status-label").classList.remove("visually-hidden"))}function DropZoneClick(e){e.parentElement.querySelector('input[type="file"]').click()}function MarkZoneCompleted(e){e.setAttribute("data-document-completed","true"),e.removeEventListener("dragenter",DropZoneDragEnter),e.removeEventListener("dragover",DropZoneDragOver),e.removeEventListener("drop",DropZoneDrop),e.removeEventListener("dragleave",DropZoneDragLeave),e.removeEventListener("click",DropZoneClick),AllowContinue()}function uploadFile(t,o){if("file"===t.type&&(t=t.parentElement.querySelector(".drop-zone")),0===o.length||1<o.length)DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"Please select a single file to upload.");else if(["application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(o[0].type)){const l=t.getAttribute("data-document-type");var e="/api/uploadFile/"+l,r=new FormData,n=(r.append("file",o[0]),localStorage.getItem("iw-token"));fetch(e,{headers:{Authorization:"Bearer "+n},method:"POST",body:r}).then(e=>{switch(e.status){case 201:t.parentElement.nextElementSibling.classList.add("visually-hidden"),t.querySelector(".status-label").classList.remove("visually-hidden"),t.classList.remove("drop-zone-drag-over","drop-zone-processing"),t.classList.add("drop-zone-success"),t.querySelector(".status-icon").querySelector("i").className="bi bi-check-circle-fill display-6 mx-3 status-icon",t.querySelector(".status-label").innerHTML=o[0].name,MarkZoneCompleted(t),gtag("event","file_upload",{document_type:l});break;case 400:ResetDropZone(t),DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"An error occurred uploading your file. Please try again.");break;default:ResetDropZone(t),DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"An unknown error occurred uploading your file. Please try again.")}}).catch(e=>{ResetDropZone(t),DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"An unknown error occurred uploading your file. Please try again.")})}else DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"At present, Interview Wizard only supports Word documents. For other document types, use the <strong>paste contents</strong> option.")}function ResetDropZone(e){e.innerHTML=dropZones.get(e.id);[...e.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e))}function UploadContent(r,e){var t=localStorage.getItem("iw-token");fetch("/api/upload/"+r,{method:"POST",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify({content:e})}).then(e=>{if(200===e.status)return gtag("event","paste_contents",{document_type:r}),e.json()}).then(e=>{switch(r){case"resume":var t=document.getElementById("drop_zone_resume"),o=e.name+" - "+e.title;t.querySelector(".status-label").innerHTML=o;break;case"position":t=document.getElementById("drop_zone_position"),o=e.jobTitle+" - "+e.advertiser;t.querySelector(".status-label").innerHTML=o}t.parentElement.nextElementSibling.classList.add("visually-hidden"),t.querySelector(".status-label").classList.remove("visually-hidden"),t.classList.remove("drop-zone-drag-over","drop-zone-processing"),t.classList.add("drop-zone-success"),t.querySelector(".status-icon").querySelector("i").className="bi bi-check-circle-fill display-6 mx-3 status-icon",MarkZoneCompleted(t),EnableTooltips()}).catch(e=>{switch(r){case"resume":var t=document.getElementById("drop_zone_resume");break;case"position":t=document.getElementById("drop_zone_position")}ResetDropZone(t),DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"An unknown error occurred uploading your data. Please try again."),EnableTooltips()})}function FetchURL(e){var t=localStorage.getItem("iw-token");fetch("/api/advert",{method:"POST",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:JSON.stringify({url:e})}).then(e=>{if(201===e.status)return gtag("event","fetch_site",{document_type:documentType}),e.json();e=document.getElementById("drop_zone_position");ResetDropZone(e),DisplayAlert(e.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"An unknown error occurred retrieving data from the address provided. Please try again."),EnableTooltips()}).then(e=>{null==e.content.jobTitle||null==e.content.advertiser?e.content.jobTitle??e.content.advertiser:t=e.content.jobTitle+" - "+e.content.advertiser;var t,e=document.getElementById("drop_zone_position");e.parentElement.nextElementSibling.classList.add("visually-hidden"),e.querySelector(".status-label").classList.remove("visually-hidden"),e.classList.remove("drop-zone-drag-over","drop-zone-processing"),e.classList.add("drop-zone-success"),e.querySelector(".status-icon").querySelector("i").className="bi bi-check-circle-fill display-6 mx-3 status-icon",e.querySelector(".status-label").innerHTML=t,MarkZoneCompleted(e),EnableTooltips()}).catch(e=>{var t=document.getElementById("drop_zone_position");ResetDropZone(t),DisplayAlert(t.parentElement.nextElementSibling.querySelector(".alert-placeholder").id,AlertTypes.Error,"An unknown error occurred retrieving data from the URL provided. Please try again."),EnableTooltips()})}function DismissTooltips(){document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(e=>{e=bootstrap.Tooltip.getInstance(e);e&&e.disable()})}function EnableTooltips(){document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(e=>{e=bootstrap.Tooltip.getInstance(e);e&&e.enable()})}function ResetDocumentsForm(){document.getElementById("btnReset").classList.add("disabled"),document.getElementById("btnReset").innerHTML='<span class="spinner-border spinner-border-sm" aria-hidden="true"></span><span class="visually-hidden" role="status"> Reset</span>';var e=localStorage.getItem("iw-token");fetch("/api/reset",{method:"POST",headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"}}).then(e=>{200===e.status&&window.location.reload()}).catch(e=>{DisplayAlert("alert-placeholder",AlertTypes.Error,"An unknown error occurred resetting the form. Please try again."),document.getElementById("btnReset").classList.remove("disabled"),document.getElementById("btnReset").innerHTML='<i class="bi bi-arrow-counterclockwise"></i> Reset'})}function AllowContinue(){let t=!0;document.querySelectorAll(".drop-zone").forEach(e=>{"true"!==e.getAttribute("data-document-completed")&&(t=!1)}),t&&document.getElementById("btnContinue").classList.remove("disabled")}document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".drop-zone").forEach(t=>{dropZones.set(t.id,t.innerHTML),t.addEventListener("dragenter",function(e){DropZoneDragEnter(t,e)}),t.addEventListener("dragover",function(e){DropZoneDragOver(t,e)}),t.addEventListener("drop",function(e){DropZoneDrop(t,e)}),t.addEventListener("dragleave",function(e){DropZoneDragLeave(t,e)}),t.addEventListener("click",function(){DropZoneClick(t)}),t.querySelectorAll(".btn").forEach(e=>{e.addEventListener("click",function(e){e.stopPropagation()})})});[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(e=>new bootstrap.Tooltip(e));const t=document.getElementById("pasteModal");t&&t.addEventListener("show.bs.modal",e=>{switch(e.relatedTarget.getAttribute("data-paste-type")){case"resume":t.querySelector(".modal-title").innerHTML="Paste CV contents",document.getElementById("txtPasteContents").setAttribute("data-paste-type","resume");break;case"position":t.querySelector(".modal-title").innerHTML="Paste position description / job advertisement contents",document.getElementById("txtPasteContents").setAttribute("data-paste-type","position")}}),document.getElementById("btnPasteCompleted").addEventListener("click",function(e){var t=document.getElementById("txtPasteContents"),o=t.getAttribute("data-paste-type"),r=t.value,t=(t.value="",t.removeAttribute("data-paste-type"),document.getElementById("drop_zone_"+o));t.classList.add("drop-zone-processing"),t.querySelector(".status-label").classList.add("visually-hidden"),t.querySelector(".status-icon").querySelector("i").classList.remove("bi-download"),t.querySelector(".status-icon").querySelector("i").classList.add("bi-cloud-arrow-up-fill","drop-zone-animation"),DismissTooltips(),UploadContent(o,r)}),document.getElementById("btnFetchURL").addEventListener("click",function(e){var t=document.getElementById("drop_zone_position");t.classList.add("drop-zone-processing"),t.querySelector(".status-label").classList.add("visually-hidden"),t.querySelector(".status-icon").querySelector("i").classList.remove("bi-download"),t.querySelector(".status-icon").querySelector("i").classList.add("bi-cloud-arrow-up-fill","drop-zone-animation"),DismissTooltips(),FetchURL(document.getElementById("txtAdvertURL").value)}),document.getElementById("btnReset").addEventListener("click",function(e){ResetDocumentsForm()}),document.getElementById("btnContinue").addEventListener("click",function(e){location.href="/preparing-questions"})});